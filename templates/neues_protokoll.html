<!-- templates/neues_protokoll.html -->
{% extends "base.html" %}

{% block title %}Neues Protokoll - Urologie Facharztpr√ºfung{% endblock %}

{% block content %}
<div class="card">
    <div class="card-header"><h1>üí° Tipps f√ºr ein gutes Protokoll</h1></div>
    <div class="card-body">
        <ul style="margin-top: 1rem; margin-bottom: 1rem;">
            <li>Beschreibe konkrete Fragen und F√§lle</li>
            <li>Notiere die Pr√ºfungsatmosph√§re und das Verhalten der Pr√ºfer</li>
            <li>Verwende passende Hashtags f√ºr bessere Auffindbarkeit</li>
            <li>Sei ehrlich und konstruktiv in deinen Kommentaren</li>
            <li>Denk daran: Deine Erfahrung hilft anderen bei der Vorbereitung!</li>
        </ul>
    </div>
</div>

<div class="card">
    <div class="card-header">
        <h1 class="card-title">Pr√ºfungsinhalt</h1>
        <p class="card-subtitle">Teil deine Pr√ºfungserfahrung mit anderen</p>
    </div>

    <form method="POST">
        <div class="row">
            <div class="col-6">
                <div class="form-group">
                    <label for="datum" class="form-label">Pr√ºfungsdatum *</label>
                    <input type="date" id="datum" name="datum" class="form-control" required>
                </div>
            </div>
            <div class="col-6">
                <div class="form-group">
                    <label for="bundesland" class="form-label">Bundesland *</label>
                    <select id="bundesland" name="bundesland" class="form-control" required onchange="loadPruefer()">
                        <option value="">Bitte w√§hlen...</option>
                        {% for bl in bundeslaender %}
                            <option value="{{ bl }}">{{ bl }}</option>
                        {% endfor %}
                    </select>
                </div>
            </div>
        </div>

        <div class="row">
            <div class="col-3">
                <div class="form-group">
                    <label for="pruefer1" class="form-label">Pr√ºfer 1 (Hauptpr√ºfer)*</label>
                    <select id="pruefer1" name="pruefer1" class="form-control" required>
                        <option value="">Erst Bundesland w√§hlen</option>
                    </select>
                </div>
            </div>
            <div class="col-3">
                <div class="form-group">
                    <label for="pruefer2" class="form-label">Pr√ºfer 2 *</label>
                    <select id="pruefer2" name="pruefer2" class="form-control" required>
                        <option value="">Erst Bundesland w√§hlen</option>
                    </select>
                </div>
            </div>
            <div class="col-3">
                <div class="form-group">
                    <label for="pruefer3" class="form-label">Pr√ºfer 3 *</label>
                    <select id="pruefer3" name="pruefer3" class="form-control" required>
                        <option value="">Erst Bundesland w√§hlen</option>
                    </select>
                </div>
            </div>
            <div class="col-3">
                <div class="form-group">
                    <label>Dein Pr√ºfer ist nicht dabei?</label>
                    <p><a href="mailto:facharztprotokolle@gesru.de?cc=admin@gesru.de&subject=Neuer%20Pr%C3%BCfer&body=Hallo%3B%0A%0Aich%20konnte%20meinen%20Pr%C3%BCfer%20in%20der%20Liste%20leider%20nicht%20finden.%20K%C3%B6nntet%20ihr%20daher%20folgenden%20Pr%C3%BCfer%20hinzuf%C3%BCgen%3F%0A%0APr%C3%BCfer%3A%20NAME%0ABundesland%3A%20XXX%0A%0AViele%20Gr%C3%BC%C3%9Fe%0ADEINNAME">Dann schreib uns eine Mail</a></p>
                </div>
            </div>
                <!--Pr√ºfer hinzuf√ºgen-->
        </div>
        <div class="form-group">
            <label for="hashtags" class="form-label">Hashtags (Themenbereiche)</label>
            <input type="text" id="hashtags" name="hashtags" class="form-control"
                   placeholder="z.B. #Kinderurologie #Prostatakarzinom #OP-Techniken"
                   list="hashtag-suggestions">
            <datalist id="hashtag-suggestions">
                {% for hashtag in predefined_hashtags %}
                    <option value="{{ hashtag }}">
                {% endfor %}
            </datalist>
            <small style="color: #86868b;">Trennen Sie mehrere Hashtags mit Leerzeichen.</small>
        </div>

        <div class="form-group">
            <label for="inhalt" class="form-label">Pr√ºfungsinhalt *</label>
            <textarea id="inhalt" name="inhalt" class="form-control" rows="8" required
                      placeholder="Beschreib hier den Inhalt der Pr√ºfung; bspw. gestellte Fragen, F√§lle, Fallstricke, etc."></textarea>
        </div>

        <div class="form-group">
            <label for="kommentar" class="form-label">Pers√∂nlicher Kommentar</label>
            <textarea id="kommentar" name="kommentar" class="form-control" rows="4"
                      placeholder="Hier ist Platz f√ºr Anmerkungen, Tipps, pers√∂nliche Einsch√§tzungen, etc. Bitte Gib auch eine kleine R√ºckmeldung zur Atmosph√§re, deinem Abschluss und einigen Besonderheiten. Bedenke aber das wir keine Beleidigungen akzeptieren. Sei daher bitte konstruktiv!"></textarea>
        </div>

        <div style="text-align: center; margin-top: 2rem;">
            <button type="submit" class="btn btn-primary" style="margin-right: 1rem;">
                üìù Protokoll speichern
            </button>
            <a href="{{ url_for('protokolle') }}" class="btn btn-secondary">Abbrechen</a>
        </div>
    </form>
</div>
{% endblock %}

{% block scripts %}
<script>
// Pr√ºfer nach Bundesland laden
function loadPruefer() {
    const bundesland = document.getElementById('bundesland').value;
    const pruefer1 = document.getElementById('pruefer1');
    const pruefer2 = document.getElementById('pruefer2');
    const pruefer3 = document.getElementById('pruefer3');

    // Reset Pr√ºfer-Selects
    [pruefer1, pruefer2, pruefer3].forEach(select => {
        select.innerHTML = '<option value="">L√§dt...</option>';
    });

    if (bundesland) {
        fetch(`/api/pruefer/${bundesland}`)
            .then(response => response.json())
            .then(data => {
                const options = '<option value="">Bitte w√§hlen...</option>' +
                    data.map(pruefer => `<option value="${pruefer.id}">${pruefer.name}</option>`).join('');

                [pruefer1, pruefer2, pruefer3].forEach(select => {
                    select.innerHTML = options;
                });
            })
            .catch(error => {
                console.error('Fehler beim Laden der Pr√ºfer:', error);
                [pruefer1, pruefer2, pruefer3].forEach(select => {
                    select.innerHTML = '<option value="">Fehler beim Laden</option>';
                });
            });
    } else {
        [pruefer1, pruefer2, pruefer3].forEach(select => {
            select.innerHTML = '<option value="">Erst Bundesland w√§hlen</option>';
        });
    }
}

// Hashtag Auto-Complete
document.getElementById('hashtags').addEventListener('input', function(e) {
    const value = e.target.value;
    const words = value.split(' ');
    const currentWord = words[words.length - 1];

    if (currentWord.startsWith('#') && currentWord.length > 1) {
        // Hier k√∂nnte eine erweiterte Auto-Complete-Logik implementiert werden
    }
});

// Form-Validierung
document.querySelector('form').addEventListener('submit', function(e) {
    const pruefer1 = document.getElementById('pruefer1').value;
    const pruefer2 = document.getElementById('pruefer2').value;
    const pruefer3 = document.getElementById('pruefer3').value;

    if (pruefer1 === pruefer2 || pruefer1 === pruefer3 || pruefer2 === pruefer3) {
        e.preventDefault();
        alert('Bitte w√§hlen Sie drei verschiedene Pr√ºfer aus. Solltest du in deiner Pr√ºfung weniger als 3 Pr√ºfer gehabt haben, dann w√§hle bitte Unbekannt aus. Sollte dein Pr√ºfer nicht dabei sein dann schreib uns eine Mail. Ein Link dazu findest du daneben.');
        return false;
    }
});
</script>
{% endblock %}